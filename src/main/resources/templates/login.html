<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>珠海市建泰环保工业园有限公司</title>
<link rel="icon" href="imgs/logo.png" type="image/x-icon" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, user-scalable=yes">
<link rel="stylesheet" href="css/login-css/style.css">
<link rel="stylesheet" href="layui/css/layui.css" media="all">
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
</head>

<body>
	<div class="cont">
		<div class="demo">
			
		
			<div class="login">
				
				<div style="text-align: center">
					<!-- 建泰环保工业园企业环保信息平台 -->
					<img src="imgs/jt2.png" style="width: 233%;height: 90%">


				</div>
				<form class="layui-form" onsubmit="return false" >
					<div id="select-div" style="color: #FDFCFD;display: none;">
						<div class="layui-form-item">
						    <div class="layui-input-block" style="margin-left: 0px!important;text-align: center;">
							    <div style="text-align: left;padding: 5px 54px 0;">
							    	<table id="manage-select"></table>
							    	
							    	
							   	</div>
							   	<div style="text-align: left;padding: 12px 56px 0;">
							    	<button class="layui-btn layui-btn-fluid" onclick="locationToHtml()" onkeydown="a(event)">选择并进入</button><br><br>
								    
								    <button class="layui-btn layui-btn-fluid" onclick="goBack()">返回上层</button>
							   	</div>
							    
							    
						    </div>
						</div>
					</div>
				</form>
				<form class="layui-form" onsubmit="return false" method="post" ay-filter="example" id="loginform">
					<input type="hidden" id="loginform:keepPassword" name="keepPassword" value="">
					<div id="login-div">
						<div class="login__form">
						<div class="login__row">
							<svg class="login__icon name svg-icon" viewBox="0 0 20 20">
								<path
									d="M0,20 a10,8 0 0,1 20,0z M10,0 a4,4 0 0,1 0,8 a4,4 0 0,1 0,-8" /> </svg>
							<input type="text" class="login__input name"
								id="loginform:username" name="username" placeholder="请输入用户名" />
						</div>
						<div class="login__row">
							<svg class="login__icon pass svg-icon" viewBox="0 0 20 20"> <path
									d="M0,20 20,20 20,8 0,8z M10,13 10,16z M4,8 a6,8 0 0,1 12,0" /></svg>
							<input type="password" class="login__input pass"
								id="loginform:password" name="password" placeholder="请输入用户密码" />
						</div>
						<div class="layui-form-item" style="padding: 14px 0 0;">
							<div class="layui-input-block" style="text-align: left;margin-left: 0px !important;">
								<input type="checkbox" title="记住密码" id="keepPasswordFlag" name="keepPasswordFlag" onclick="login()" lay-skin="primary">
							</div>
						</div>
						<button class="layui-btn layui-btn-fluid" lay-submit lay-filter="loginform">登录</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script src="layui/layui.js" charset="utf-8"></script>

	
	<script>
		//Demo
		var manage;//选择的公司
		var htmls = {'建泰': 'page/views/index.html'};
		
		layui.use('form', function(){
		  var $ = layui.$;
		  var form = layui.form;
		  
		  //监听单选框
		  form.on('radio', function(data){
			  if(data.value){
				  manage = data.value;
			  }
		  });
		  
		  //监听提交
		  form.on('submit(loginform)', function(data){
			  if($("input[name='username']").val().trim() == ""){
				  layer.msg("请输入用户名");
				  $("input[name='username']").val("");
				  $("input[name='username']").focus();
				  return;
			  }
				
			  if($("input[name='password']").val() == ""){
				  layer.msg("请输入密码");
				  $("input[name='password']").focus();
				  return;
			  }
			  //layer.msg(typeof(data.field.keepPasswordFlag));
			  if(data.field.keepPasswordFlag){
				  $("input[name='keepPassword']").val("on");
			  } else {
				  $("input[name='keepPassword']").val("off");
			  }
			  
			  layui.form.render(); //重新渲染显示效果
			  $.post("user/companyLogin",$("#loginform").serialize(),function(data){
					if(!data.error){

						if (data.type == 1) {
                            window.location.href = "admin/index.html";
						}else {
                            window.location.href = "home/index.html";
						}

					}else{
						layer.msg("登录失败：" + data.error);
					}
				},"json");
		  		return false;
		  });
		  
		  $(function(){
				$.post("user/cookie",function(data){
					if(data.user && data.password){
						$("input[name='username']").val(data.user);
						$("input[name='password']").val(data.password);
						$("input[name='keepPasswordFlag']").attr("checked", true); //注意这里使用的是attr()
						form.render();
					}
				},"json");
				
			})	
		});
		
		function goBack(){
			/* $("#login-div").show();
			$("#select-div").hide(); */
			window.location.href ='user/logout';
		}
		
		function locationToHtml(){
			if(!htmls[manage]){
				layer.msg("页面尚未开放");
			}
			
 			if(manage){
 				location.href = htmls[manage];
 			} else {
 				layer.msg("请选择公司");
 			}
 		}
		
	</script>
	
	
	
	
	
	
</body>
</html>
